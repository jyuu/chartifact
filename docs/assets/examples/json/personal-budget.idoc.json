{
  "$schema": "https://microsoft.github.io/chartifact/schema/idoc_v1.json",
  "title": "Dental Clinic Budget Planner",
  "style": {
    "css": [
      "body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: #f0f9ff; }",
      "body { display: grid; grid-template-areas: 'header header' 'overview overview' 'allocation variance' 'controls categories' 'trends trends'; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 1400px; margin: 0 auto; }",
      ".group { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }",
  "#header { grid-area: header; background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%); color: white; text-align: center; }",
      "#overview { grid-area: overview; text-align: center; }",
      "#allocation { grid-area: allocation; min-width: 0; overflow: hidden; }",
      "#variance { grid-area: variance; min-width: 0; overflow: hidden; }",
      "#controls { grid-area: controls; min-width: 0; overflow: hidden; }",
      "#categories { grid-area: categories; min-width: 0; overflow: hidden; }",
      "#trends { grid-area: trends; min-width: 0; overflow: hidden; }",
  "h1 { margin: 0; padding: 20px 0; font-size: 2em; font-weight: 600; font-family: 'Inter', sans-serif; }",
  "h2 { margin: 10px 0; font-size: 2em; color: #0369a1; font-weight: 600; }",
  "h3 { margin: 0 0 15px 0; font-size: 1.2em; color: #0284c7; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }",
      ".tabulator { max-width: 100%; overflow: auto; }",
      ".tabulator .tabulator-table { min-width: fit-content; }",
      ".slider-container { margin: 15px 0; }",
      ".slider-label { font-weight: 500; color: #2d3748; margin-bottom: 8px; display: block; }",
  "@media (max-width: 768px) { body { grid-template-columns: 1fr; grid-template-areas: 'header' 'overview' 'allocation' 'variance' 'controls' 'categories' 'trends'; } }"
    ]
  },
  "dataLoaders": [
    {
      "dataSourceName": "budgetCategories",
      "type": "inline",
      "format": "csv",
      "content": [
        "category,budgeted,spent,color",
        "Rent,4000,4000,#0284c7",
        "Staff,8000,7800,#0369a1",
        "Equipment,2000,1900,#0891b2",
        "Supplies,1500,1450,#06b6d4",
        "Insurance,1200,1200,#0ea5e9",
        "Marketing,800,750,#22d3ee",
        "Utilities,600,580,#67e8f9",
        "Maintenance,400,380,#a7f3d0",
        "Savings,1000,1000,#10b981"
      ]
    },
    {
      "dataSourceName": "monthlyTrends",
      "type": "inline",
      "format": "csv",
      "content": [
        "month,Rent,Staff,Equipment,Supplies,Insurance,Marketing,Utilities,Maintenance,Savings",
        "2024-01,4000,7500,1800,1400,1200,700,550,350,1000",
        "2024-02,4000,7800,1900,1450,1200,750,580,400,1000",
        "2024-03,4000,7600,2000,1500,1200,800,600,380,1000",
        "2024-04,4000,7900,1850,1480,1200,780,590,420,1000",
        "2024-05,4000,7700,1950,1520,1200,820,570,360,1000",
        "2024-06,4000,7800,1900,1450,1200,750,580,380,1000"
      ]
    }
  ],
  "variables": [
    {
      "variableId": "monthlyRevenue",
      "type": "number",
      "initialValue": 25000
    },
    {
      "variableId": "rentBudget",
      "type": "number",
      "initialValue": 4000
    },
    {
      "variableId": "staffBudget",
      "type": "number",
      "initialValue": 8000
    },
    {
      "variableId": "equipmentBudget",
      "type": "number",
      "initialValue": 2000
    },
    {
      "variableId": "suppliesBudget",
      "type": "number",
      "initialValue": 1500
    },
    {
      "variableId": "insuranceBudget",
      "type": "number",
      "initialValue": 1200
    },
    {
      "variableId": "marketingBudget",
      "type": "number",
      "initialValue": 800
    },
    {
      "variableId": "utilitiesBudget",
      "type": "number",
      "initialValue": 600
    },
    {
      "variableId": "maintenanceBudget",
      "type": "number",
      "initialValue": 400
    },
    {
      "variableId": "savingsBudget",
      "type": "number",
      "initialValue": 1000
    },
    {
      "variableId": "rentActual",
      "type": "number",
      "initialValue": 4000
    },
    {
      "variableId": "staffActual",
      "type": "number",
      "initialValue": 7800
    },
    {
      "variableId": "equipmentActual",
      "type": "number",
      "initialValue": 1900
    },
    {
      "variableId": "suppliesActual",
      "type": "number",
      "initialValue": 1450
    },
    {
      "variableId": "insuranceActual",
      "type": "number",
      "initialValue": 1200
    },
    {
      "variableId": "marketingActual",
      "type": "number",
      "initialValue": 750
    },
    {
      "variableId": "utilitiesActual",
      "type": "number",
      "initialValue": 580
    },
    {
      "variableId": "maintenanceActual",
      "type": "number",
      "initialValue": 380
    },
    {
      "variableId": "savingsActual",
      "type": "number",
      "initialValue": 1000
    },
    {
      "variableId": "adjustedBudgetData",
      "type": "object",
      "isArray": true,
      "initialValue": [],
      "calculation": {
        "dataSourceNames": [
          "budgetCategories"
        ],
        "dataFrameTransformations": [
          {
            "type": "formula",
            "expr": "datum.category === 'Rent' ? rentBudget : (datum.category === 'Staff' ? staffBudget : (datum.category === 'Equipment' ? equipmentBudget : (datum.category === 'Supplies' ? suppliesBudget : (datum.category === 'Insurance' ? insuranceBudget : (datum.category === 'Marketing' ? marketingBudget : (datum.category === 'Utilities' ? utilitiesBudget : (datum.category === 'Maintenance' ? maintenanceBudget : (datum.category === 'Savings' ? savingsBudget : datum.budgeted)))))))))",
            "as": "adjustedBudget"
          },
          {
            "type": "formula",
            "expr": "datum.adjustedBudget - datum.spent",
            "as": "remaining"
          },
          {
            "type": "formula",
            "expr": "(datum.spent - datum.adjustedBudget) / datum.adjustedBudget",
            "as": "spentPercentage"
          }
        ]
      }
    },
    {
      "variableId": "totalBudgeted",
      "type": "number",
      "initialValue": 0,
      "calculation": {
        "vegaExpression": "toNumber(rentBudget) + toNumber(staffBudget) + toNumber(equipmentBudget) + toNumber(suppliesBudget) + toNumber(insuranceBudget) + toNumber(marketingBudget) + toNumber(utilitiesBudget) + toNumber(maintenanceBudget) + toNumber(savingsBudget)"
      }
    },
    {
      "variableId": "totalSpent",
      "type": "number",
      "initialValue": 0,
      "calculation": {
        "vegaExpression": "toNumber(rentActual) + toNumber(staffActual) + toNumber(equipmentActual) + toNumber(suppliesActual) + toNumber(insuranceActual) + toNumber(marketingActual) + toNumber(utilitiesActual) + toNumber(maintenanceActual) + toNumber(savingsActual)"
      }
    },
    {
      "variableId": "totalRemaining",
      "type": "number",
      "initialValue": 0,
      "calculation": {
        "vegaExpression": "toNumber(totalBudgeted) - toNumber(totalSpent)"
      }
    },
    {
      "variableId": "savingsRate",
      "type": "string",
      "initialValue": "0%",
      "calculation": {
        "vegaExpression": "format((savingsBudget / monthlyRevenue) * 100, '.1f') + '%'"
      }
    },
    {
      "variableId": "monthlyTrendsLong",
      "type": "object",
      "isArray": true,
      "initialValue": [],
      "calculation": {
        "dataSourceNames": [
          "monthlyTrends"
        ],
        "dataFrameTransformations": [
          {
            "type": "fold",
            "fields": [
              "Rent",
              "Staff",
              "Equipment",
              "Supplies",
              "Insurance",
              "Marketing",
              "Utilities",
              "Maintenance",
              "Savings"
            ],
            "as": [
              "category",
              "amount"
            ]
          }
        ]
      }
    },
    {
      "variableId": "budgetVarianceData",
      "type": "object",
      "isArray": true,
      "initialValue": [],
      "calculation": {
        "dataSourceNames": [
          "budgetCategories"
        ],
        "dataFrameTransformations": [
          {
            "type": "filter",
            "expr": "datum.category === 'Rent' || datum.category === 'Staff' || datum.category === 'Equipment' || datum.category === 'Supplies' || datum.category === 'Insurance' || datum.category === 'Marketing' || datum.category === 'Utilities' || datum.category === 'Maintenance' || datum.category === 'Savings'"
          },
          {
            "type": "formula",
            "expr": "datum.category === 'Rent' ? rentBudget : (datum.category === 'Staff' ? staffBudget : (datum.category === 'Equipment' ? equipmentBudget : (datum.category === 'Supplies' ? suppliesBudget : (datum.category === 'Insurance' ? insuranceBudget : (datum.category === 'Marketing' ? marketingBudget : (datum.category === 'Utilities' ? utilitiesBudget : (datum.category === 'Maintenance' ? maintenanceBudget : (datum.category === 'Savings' ? savingsBudget : datum.budgeted)))))))))",
            "as": "budgeted"
          },
          {
            "type": "formula",
            "expr": "datum.category === 'Rent' ? rentActual : (datum.category === 'Staff' ? staffActual : (datum.category === 'Equipment' ? equipmentActual : (datum.category === 'Supplies' ? suppliesActual : (datum.category === 'Insurance' ? insuranceActual : (datum.category === 'Marketing' ? marketingActual : (datum.category === 'Utilities' ? utilitiesActual : (datum.category === 'Maintenance' ? maintenanceActual : (datum.category === 'Savings' ? savingsActual : datum.spent)))))))))",
            "as": "spent"
          },
          {
            "type": "formula",
            "expr": "datum.spent - datum.budgeted",
            "as": "variance"
          }
        ]
      }
    }
  ],
  "groups": [
    {
      "groupId": "header",
      "elements": [
        "# ðŸ¦· Dental Clinic Budget Planner",
        "**Interactive budget planning tool for your dental practice's financial wellness**"
      ]
    },
    {
      "groupId": "overview",
      "elements": [
        "### ðŸ“Š Budget Overview",
        {
          "type": "slider",
          "variableId": "monthlyRevenue",
          "label": "Monthly Revenue",
          "min": 15000,
          "max": 50000,
          "step": 1000
        },
        "**Total Budgeted:** ${{totalBudgeted}}",
        "**Total Spent:** ${{totalSpent}}",
        "**Remaining Budget:** ${{totalRemaining}}",
        "**Savings Rate:** {{savingsRate}}"
      ]
    },
    {
      "groupId": "allocation",
      "elements": [
        "### ðŸ¥§ Budget Allocation",
        {
          "type": "chart",
          "chartKey": "budgetPieChart"
        }
      ]
    },
    {
      "groupId": "variance",
      "elements": [
        "### ðŸ“Š Budget vs Actual",
        {
          "type": "chart",
          "chartKey": "budgetVarianceChart"
        }
      ]
    },
    {
      "groupId": "controls",
      "elements": [
        "### ï¿½ Budget Category Adjustments",
        {
          "type": "slider",
          "variableId": "rentBudget",
          "label": "Rent",
          "min": 2000,
          "max": 8000,
          "step": 200
        },
        {
          "type": "slider",
          "variableId": "staffBudget",
          "label": "Staff",
          "min": 4000,
          "max": 15000,
          "step": 200
        },
        {
          "type": "slider",
          "variableId": "equipmentBudget",
          "label": "Equipment",
          "min": 1000,
          "max": 5000,
          "step": 100
        },
        {
          "type": "slider",
          "variableId": "suppliesBudget",
          "label": "Supplies",
          "min": 500,
          "max": 3000,
          "step": 50
        },
        {
          "type": "slider",
          "variableId": "insuranceBudget",
          "label": "Insurance",
          "min": 500,
          "max": 2500,
          "step": 100
        },
        {
          "type": "slider",
          "variableId": "marketingBudget",
          "label": "Marketing",
          "min": 200,
          "max": 2000,
          "step": 50
        },
        {
          "type": "slider",
          "variableId": "utilitiesBudget",
          "label": "Utilities",
          "min": 300,
          "max": 1500,
          "step": 50
        },
        {
          "type": "slider",
          "variableId": "maintenanceBudget",
          "label": "Maintenance",
          "min": 200,
          "max": 1000,
          "step": 50
        },
        {
          "type": "slider",
          "variableId": "savingsBudget",
          "label": "Savings",
          "min": 500,
          "max": 3000,
          "step": 100
        }
      ]
    },
    {
      "groupId": "categories",
      "elements": [
        "### ðŸ“‹ Track This Month's Spending",
        {
          "type": "number",
          "variableId": "rentActual",
          "label": "Rent Actual"
        },
        {
          "type": "number",
          "variableId": "staffActual",
          "label": "Staff Actual"
        },
        {
          "type": "number",
          "variableId": "equipmentActual",
          "label": "Equipment Actual"
        },
        {
          "type": "number",
          "variableId": "suppliesActual",
          "label": "Supplies Actual"
        },
        {
          "type": "number",
          "variableId": "insuranceActual",
          "label": "Insurance Actual"
        },
        {
          "type": "number",
          "variableId": "marketingActual",
          "label": "Marketing Actual"
        },
        {
          "type": "number",
          "variableId": "utilitiesActual",
          "label": "Utilities Actual"
        },
        {
          "type": "number",
          "variableId": "maintenanceActual",
          "label": "Maintenance Actual"
        },
        {
          "type": "number",
          "variableId": "savingsActual",
          "label": "Savings Actual"
        }
      ]
    },
    {
      "groupId": "trends",
      "elements": [
        "### ðŸ“ˆ Spending Trends",
        {
          "type": "chart",
          "chartKey": "spendingTrendsChart"
        }
      ]
    }
  ],
  "resources": {
    "charts": {
      "budgetPieChart": {
        "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
        "width": "container",
        "height": 300,
        "data": {
          "name": "adjustedBudgetData"
        },
        "mark": {
          "type": "arc",
          "innerRadius": 50,
          "stroke": "white",
          "strokeWidth": 2
        },
        "encoding": {
          "theta": {
            "field": "adjustedBudget",
            "type": "quantitative",
            "title": "Budget Amount"
          },
          "color": {
            "field": "category",
            "type": "nominal",
            "scale": {
              "range": [
                "#0284c7",
                "#0369a1",
                "#0891b2",
                "#06b6d4",
                "#0ea5e9",
                "#22d3ee",
                "#67e8f9",
                "#a7f3d0",
                "#10b981"
              ]
            },
            "legend": {
              "orient": "right",
              "title": "Categories"
            }
          },
          "tooltip": [
            {
              "field": "category",
              "type": "nominal",
              "title": "Category"
            },
            {
              "field": "adjustedBudget",
              "type": "quantitative",
              "title": "Budgeted",
              "format": "$,.0f"
            },
            {
              "field": "spent",
              "type": "quantitative",
              "title": "Spent",
              "format": "$,.0f"
            },
            {
              "field": "remaining",
              "type": "quantitative",
              "title": "Remaining",
              "format": "$,.0f"
            }
          ]
        }
      },
      "spendingTrendsChart": {
        "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
        "width": "container",
        "height": 300,
        "data": {
          "name": "monthlyTrendsLong"
        },
        "mark": {
          "type": "line",
          "point": true,
          "strokeWidth": 2
        },
        "encoding": {
          "x": {
            "field": "month",
            "type": "temporal",
            "title": "Month",
            "axis": {
              "format": "%b %Y"
            }
          },
          "y": {
            "field": "amount",
            "type": "quantitative",
            "title": "Amount Spent ($)"
          },
          "color": {
            "field": "category",
            "type": "nominal",
            "scale": {
              "range": [
                "#0284c7",
                "#0369a1",
                "#0891b2",
                "#06b6d4",
                "#0ea5e9",
                "#22d3ee",
                "#67e8f9",
                "#a7f3d0",
                "#10b981"
              ]
            },
            "legend": {
              "title": "Category"
            }
          },
          "tooltip": [
            {
              "field": "month",
              "type": "temporal",
              "title": "Month",
              "format": "%B %Y"
            },
            {
              "field": "category",
              "type": "nominal",
              "title": "Category"
            },
            {
              "field": "amount",
              "type": "quantitative",
              "title": "Amount",
              "format": "$,.0f"
            }
          ]
        }
      },
      "budgetVarianceChart": {
        "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
        "description": "Budget variance bar chart with negative values. Shows budget vs actual spending differences.",
        "width": "container",
        "height": 300,
        "data": {
          "name": "budgetVarianceData"
        },
        "encoding": {
          "y": {
            "field": "category",
            "type": "nominal",
            "axis": {
              "domain": false,
              "ticks": false,
              "labelAngle": 0,
              "labelPadding": 4
            },
            "title": "Category"
          },
          "x": {
            "field": "variance",
            "type": "quantitative",
            "scale": {
              "padding": 20
            },
            "axis": {
              "gridColor": {
                "condition": {
                  "test": "datum.value === 0",
                  "value": "black"
                },
                "value": "#ddd"
              }
            },
            "title": "Variance (Actual - Budget)"
          }
        },
        "layer": [
          {
            "mark": "bar",
            "encoding": {
              "color": {
                "condition": {
                  "test": "datum.variance < 0",
                  "value": "#22c55e"
                },
                "value": "#ef4444"
              }
            }
          },
          {
            "mark": {
              "type": "text",
              "align": {
                "expr": "datum.variance < 0 ? 'right' : 'left'"
              },
              "dx": {
                "expr": "datum.variance < 0 ? -2 : 2"
              }
            },
            "encoding": {
              "text": {
                "field": "variance",
                "type": "quantitative",
                "format": "$,.0f"
              }
            }
          }
        ]
      }
    }
  }
}